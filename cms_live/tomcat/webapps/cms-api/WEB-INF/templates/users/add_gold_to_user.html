<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

	<head>

		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<link rel="icon" type="image/png" sizes="96x96"
			  href="/favicon-96x96.png"
			  th:href="@{/resources/dashboard_files/favicon.png}" />

		<title data-th-text="#{admin.page.title}">Game - User Detail</title>

		<!-- Core CSS - Include with every page -->
		<link href="../css/bootstrap.min.css" rel="stylesheet"
			  th:href="@{/resources/sb-admin-v2/css/bootstrap.min.css}" />
		<link href="../font-awesome/css/font-awesome.css" rel="stylesheet"
			  th:href="@{/resources/sb-admin-v2/font-awesome/css/font-awesome.css}" />
		<link rel="stylesheet" type="text/css" media="all"
			  href="../bootstrap-daterangepicker/daterangepicker-bs3.css"
			  th:href="@{/resources/bootstrap-daterangepicker/daterangepicker-bs3.css}" />
		<!-- DataTables CSS -->
		<link href="css/plugins/dataTables.bootstrap.css" rel="stylesheet"
			  th:href="@{/resources/sb-admin-v2/css/plugins/dataTables/jquery.dataTables.min.css}" />
		<link href="css/plugins/responsive.dataTables.min.css" rel="stylesheet"
			  th:href="@{/resources/sb-admin-v2/css/plugins/dataTables/responsive.dataTables.min.css}" />
		<!-- Page-Level Plugin CSS - Dashboard -->
		<link href="../css/plugins/morris/morris-0.4.3.min.css" rel="stylesheet"
			  th:href="@{/resources/sb-admin-v2/css/plugins/morris/morris-0.4.3.min.css}" />
		<link href="../css/plugins/timeline/timeline.css" rel="stylesheet"
			  th:href="@{/resources/sb-admin-v2/css/plugins/timeline/timeline.css}" />
		<link href="../bootstrapformhelpers/css/bootstrap-formhelpers.min.css"
			  rel="stylesheet"
			  th:href="@{/resources/bootstrapformhelpers/css/bootstrap-formhelpers.min.css}" />
		<!-- SB Admin CSS - Include with every page -->
		<link href="../css/sb-admin.css" rel="stylesheet"
			  th:href="@{/resources/sb-admin-v2/css/sb-admin.css}" />

	</head>

	<body>

		<div id="wrapper">
			<div data-th-replace="fragments/sb-admin :: top-nav"></div>
			<div data-th-replace="fragments/sb-admin :: vert-nav-admin"></div>
			<div id="page-wrapper">
				<div class="row">
					<div class="col-lg-12">
						<h1 class="page-header">
							Giao dịch - chuyển tiền
						</h1>
					</div>
					<!-- /.col-lg-12 -->
				</div>
				<div class="row" th:if="${get_back_success == true}">
					<div class="col-lg-12">
						<div class="alert alert-success">
							<p>Chuyển tiền cho user thành công. Tài khoản: <span th:text="${user.fullname}"></span></p>
						</div>
					</div>
				</div>
				<div class="row" th:if="${get_back_failure == true}">
					<div class="col-xs-12">
						<div class="alert alert-warning">
							<p>Thất bại. Vui lòng thử lại!</p>
						</div>
					</div>
				</div>
				<p th:text="${message}"></p>
				<!-- /.row -->
				<div class="row">
					<div class="col-xs-12">
						<form role="form" method="post" action="add_gold_to_user.html"
							  th:action="@{/users/add_gold_to_user.html}">
							<div class="container-fluid">
								<div class="row">
									<div class="col-xs-6">
										<div class="form-group" >
												<label>Id nhận tiền<img id="user_name_loading" style="width: 20px;display: none;" src="https://media.giphy.com/media/sSgvbe1m3n93G/200.gif" /></label> 
												<span th:if="${user} != null">
													<input class="form-control"
																		 th:value="${user.id}" name="target_user"
																		 id="user_id" />
												</span>
												<span th:unless="${user} != null">
													<input class="form-control" name="target_user" 
																		 id="user_id" />
												</span>
										</div>
										<div class="form-group">
												<label for="in_add_gold">Số tiền</label>
												<input id="in_add_gold" class="form-control" name="amount" />
										</div>
										<div class="form-group">
											<label for="in_reason">Nội dung</label>
											<textarea id="in_reason" class="form-control" name="reason"></textarea>
										</div>
										<div class="form-group" sec:authorize="!hasAnyRole('ROLE_ADMIN')">
											<label for="in_otp">Mã OTP: </label>
											<input id="in_otp" class="form-control" name="otp" />
										</div>
										<div class="form-group" sec:authorize="hasAnyRole('ROLE_ADMIN')">
											<label>Id phát tiền</label>
											<input class="form-control" value="1" name="source_user" />
										</div>
										<button class="btn btn-info btn-sm" id="submit" type="submit" title="Lưu">Thực hiện <i class="fa fa-check"> </i></button>
									</div>
									<div class="col-xs-6">
										<div class="form-group">
												<label>Tên nhân vật</label>
												<input class="form-control"  id="user_name"
													   readonly="readonly" />
										</div>
									</div>
								</div>
							</div>
						</form>
						<!-- /.panel -->
					</div>
					<!-- /.col-lg-12 -->
				</div>
				<!-- /.row -->
			</div>
			<!-- /#page-wrapper -->
		</div>
		<!-- /#wrapper -->

		<!-- Core Scripts - Include with every page -->
		<script src="../js/jquery-1.10.2.js"
		th:src="@{/resources/sb-admin-v2/js/jquery-1.10.2.js}"></script>
		<script src="../js/bootstrap.min.js"
		th:src="@{/resources/sb-admin-v2/js/bootstrap.min.js}"></script>
		<script src="../js/plugins/metisMenu/jquery.metisMenu.js"
		th:src="@{/resources/sb-admin-v2/js/plugins/metisMenu/jquery.metisMenu.js}"></script>

		<!-- Page-Level Plugin Scripts - Dashboard -->
		<script src="../bootstrapformhelpers/js/bootstrap-formhelpers.js"
		th:src="@{/resources/bootstrapformhelpers/js/bootstrap-formhelpers.js}"></script>
		<script type="text/javascript"
				src="../bootstrap-daterangepicker/moment.js"
		th:src="@{/resources/bootstrap-daterangepicker/moment.js}"></script>
		<script type="text/javascript"
				src="../bootstrap-daterangepicker/daterangepicker.js"
		th:src="@{/resources/bootstrap-daterangepicker/daterangepicker.js}"></script>
		<!-- Page-Level Plugin Scripts - Tables -->
		<script src="js/plugins/dataTables/jquery.dataTables.js"
		th:src="@{/resources/sb-admin-v2/js/plugins/dataTables/jquery.dataTables.min.js}"></script>
		<script src="js/plugins/dataTables/dataTables.bootstrap.js"
		th:src="@{/resources/sb-admin-v2/js/plugins/dataTables/dataTables.responsive.min.js}"></script>
		<!-- SB Admin Scripts - Include with every page -->
		<script src="../js/sb-admin.js"
		th:src="@{/resources/sb-admin-v2/js/sb-admin.js}"></script>

		<script th:inline="javascript">
			/*<![CDATA[*/
			var currUrl = /*[[@{/}]]*/"";
			var getBackResult = /*[[@{json_result}]]*/"";
			console.log("getBackResult: ")
			console.log(getBackResult)
			/*]]>*/
		</script>
		
		<script>
			// Chặn nhấn phím enter
			$(document).keypress(
				function(event){
				  if (event.which == '13') {
					event.preventDefault();
				  }
			});

			var timeoutSendAjaxGetFullName;
			jQuery(document).ready(($)=>{
				$('#user_id').keydown(()=>{
					clearInterval(timeoutSendAjaxGetFullName);
					timeoutSendAjaxGetFullName = setTimeout(()=>{
						$('#submit').prop('disabled', true);
						$('#user_name_loading').show();
						ajaxGetFullname();
					}, 1000);
				});
				$('#in_add_gold').focusout(()=>{
					let value = $('#in_add_gold').val();
					value = value.replaceAll(",", "");
					$('#in_add_gold').val( numberWithCommas(value) );
				});
				$('#submit').click(()=>{
					let value = $('#in_add_gold').val();
					value = value.replaceAll(",", "");
					$('#in_add_gold').val(value);
				});
			});
			function ajaxGetFullname(){
				let $ = jQuery;
				$.ajax({url: 'https://x4taikhoan.com/api/game/otp_app_get_userfullname.jsp?target_id='+$('#user_id').val(), success: function(result){
					$('#user_name').val(result);
					$('#submit').prop('disabled', false);
					$('#user_name_loading').hide();
				}, error(xhr,status,error){
					console.log("error: "+error);
					$('#submit').prop('disabled', false);
					$('#user_name_loading').hide();
				}});
			}
			const numberWithCommas = (x) => {
				return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
			}
			String.prototype.replaceAll = function (search, replacement) {
				var target = this;
				return target.replace(new RegExp(search, 'g'), replacement);
			};
		</script>

		<!-- Page-Level Demo Scripts - Forms - Use for reference -->

	</body>

</html>
