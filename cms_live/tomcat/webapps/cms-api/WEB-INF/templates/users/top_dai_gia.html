<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<head>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="icon" type="image/png" sizes="96x96"
	href="/favicon-96x96.png"
	th:href="@{/resources/dashboard_files/favicon.png}" />

<title data-th-text="#{admin.page.title}">Yoker - Users</title>

<!-- Core CSS - Include with every page -->
<link href="../css/bootstrap.min.css" rel="stylesheet"
	th:href="@{/resources/sb-admin-v2/css/bootstrap.min.css}" />
<link href="../font-awesome/css/font-awesome.css" rel="stylesheet"
	th:href="@{/resources/sb-admin-v2/font-awesome/css/font-awesome.css}" />
<link href="../bootstrap-daterangepicker/daterangepicker-bs3.css"
	rel="stylesheet" type="text/css" media="all"
	th:href="@{/resources/bootstrap-daterangepicker/daterangepicker-bs3.css}" />
<!-- Page-Level Plugin CSS - Dashboard -->
<link href="../css/plugins/dataTables/dataTables.bootstrap.css"
	rel="stylesheet"
	th:href="@{/resources/sb-admin-v2/css/plugins/dataTables/dataTables.bootstrap.css}" />
<!-- SB Admin CSS - Include with every page -->
<link href="../css/sb-admin.css" rel="stylesheet"
	th:href="@{/resources/sb-admin-v2/css/sb-admin.css}" />

</head>

<body>

	<div id="wrapper">
		<div th:if="${userType} == 1">
			<div data-th-replace="fragments/sb-admin :: top-nav"></div>
			<div data-th-replace="fragments/sb-admin :: vert-nav-admin"></div>
		</div>
		<div th:if="${userType} == 2">
			<div data-th-replace="fragments/sb-admin :: top-nav"></div>
			<div data-th-replace="fragments/sb-admin :: vert-nav-admin"></div>
		</div>		
		<div th:if="${userType} == 3">
			<div data-th-replace="cskh/sb-care :: top-nav"></div>
			<div data-th-replace="cskh/sb-care :: vert-nav-admin"></div>
		</div>
		<div id="page-wrapper">
			<div class="row" th:if="${type!=2}">
				<div class="col-lg-12">
					<h1 class="page-header">
						Danh sách đại gia
					</h1>
				</div>
				<!-- /.col-lg-12 -->
			</div>
                    
			<div class="row" th:if="${type!=2}">
                            <form role="form" class="form-horizontal" method="get" th:action="@{/users/top_dai_gia.html}">
                                <div class="col-lg-4">
					<div class="input-group custom-search-form">
<!--                                            <select name="user_type" class="form-control">
                                                <option value="thanhhu">Người dùng thường</option>
                                                <option value="agency_level_1">Đại lý cấp 1</option>
                                                <option value="agency_level_2">Đại lý cấp 2</option>
                                                <option value="agency_card">Đại lý thẻ</option>
                                                <option value="live_account">Tài khoản live</option>
                                            </select>-->
						<input name="list_id_tk_live" value="1015213,441457282,1015585,1014169,1014761,699361835,1015888,1014151,1014689,268268,1111368,1014446,1013637,1013611,1013539,679230142,1014539,1014081,1013596,1015012" type="text" style="display:none"/>
<!--						 <span class="input-group-btn">
							<button class="btn btn-default" type="submit">
								<i class="fa fa-search"></i>
							</button>
						</span>-->
					</div>
					<!-- /input-group -->
				</div>
                            </form>
				<input type="text" hidden="true" readonly="readonly" value=""
					th:value="@{/users/list.html?fullname=}" id="idSearchLink" />
<!--				<div class="col-lg-4">
					<div class="input-group custom-search-form">
						<input type="text" class="form-control"
							placeholder="Người chơi..."
							onkeyup="if (event.keyCode == 13) doSearchUser();"
							id="idSearchValue" /> <span class="input-group-btn">
							<button class="btn btn-default" type="button"
								onclick="doSearchUser();">
								<i class="fa fa-search"></i>
							</button>
						</span>
					</div>
					 /input-group 
				</div>
				<div class="col-lg-4">
					<div class="input-group custom-search-form">
						<input type="text" class="form-control"
							placeholder="Số điện thoại..."
							onkeyup="if (event.keyCode == 13) doSearchUser();"
							id="idSearchValueMobile" /> <span class="input-group-btn">
							<button class="btn btn-default" type="button"
								onclick="doSearchUser();">
								<i class="fa fa-search"></i>
							</button>
						</span>
					</div>
				</div>-->

				<!-- <div class="input-group custom-search-form">
                            <input type="text" hidden="true" readonly="readonly" value="" th:value="@{/users/list.html?fullname=}" id="idSearchLink"/>
                            <span >
                                <input type="text" placeholder="Người chơi..." onkeyup="if (event.keyCode == 13) doSearchUser();" id="idSearchValue"/>
                            </span>
                            <input type="text" placeholder="Số điện thoại..." onkeyup="if (event.keyCode == 13) doSearchUser();" id="idSearchValueMobile"/>
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="button" onclick="doSearchUser();">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                        </div> -->
			</div>
			<div class="row">
				<div class="col-lg-12">
					<h1 class="page-header"></h1>
				</div>
			</div>
			<div class="row" th:if="${type==2}">
				<div class="panel-body">
					<form role="form" method="post" action="/users/list.html?type=2"
						th:action="@{/users/list.html?type=2}">
						<div class="row">
							<div class="col-lg-4">
								<label>Từ ngày đến ngày</label>
								<div class="input-prepend input-group">
									<span class="add-on input-group-addon"><i
										class="glyphicon glyphicon-calendar fa fa-calendar"></i></span> <input
										type="text" name="from_date" id="from_date" hidden="true"
										th:value="${from_date}" /> <input type="text" name="to_date"
										id="to_date" hidden="true" th:value="${to_date}" /> <input
										type="text" style="width: 100%" name="date_range"
										id="reservationtime" class="form-control span4"
										value="08/01/2013 - 08/01/2013"
										th:value="${from_date} + ' - ' + ${to_date}"
										readonly="readonly" />
								</div>
							</div>
							<div class="col-lg-2">
								<label>&nbsp;</label>
								<div>
									<button type="submit" class="btn btn-info">Xem thông
										tin</button>
								</div>
							</div>
						</div>
						<br />
					</form>
					<!-- /.row (nested) -->
				</div>
			</div>
			<!-- /.row -->
			<div class="row">
				<div class="col-lg-12">
					
					<div class="panel panel-primary" th:if="${type==3}">
						<div class="panel-heading">Danh sách người chơi</div>
						<!-- /.panel-heading -->
						<div class="panel-body">
							<div class="table-responsive" >
                                <p>Tổng tiền của các người dùng trong danh sách: <span class="total_user_gold">0</span></p>
								<p id="sum_gold" th:text="${sum_gold}" style="display: none;"></p>
								<table class="table table-striped table-bordered table-hover"
									id="dataTables-userTop">
									<thead>
										<tr>
											<th>ID</th>
											<th>Username</th>
											<th>Full Name</th>
											<th>Mã đại lí</th>
											<th>Mobile</th>
											<th>Gold</th>
<!--											<th>+</th>-->
										</tr>
									</thead>
<!--                                                                    Khai báo biến total-->
									<tbody>
										<tr class="odd gradeX" th:each="oneUser : ${users}">
											<td><a href="#" th:href="@{'/users/edit_user.html?user_id=' + ${oneUser.id}}"  th:text="${oneUser.id}"></a></td>
											<td><a href="#"
												th:href="@{'/users/edit_user.html?user_id=' + ${oneUser.id}}"
												th:text="${oneUser.username}"></a></td>
<!--                                                                                        <td><a href="add_money.html?user_id=1'"
												th:href="@{'/users/detail.html?user_id=' + ${oneUser.id}}"
												th:text="${oneUser.username}">Abc</a></td>-->
											<td><a href="#"
												th:href="@{'/users/edit_user.html?user_id=' + ${oneUser.id}}"
												th:text="${oneUser.fullname}"></a></td>
											<td th:text="${oneUser.refcode}" class="center"></td>
											<td th:text="${oneUser.mobile}" class="center"></td>
											<td
												th:text="${#numbers.formatDecimal(oneUser.gold.gold, 0, 'COMMA', 0, 'POINT')}"
												class="center user_gold_amount" style="background: #fff7d9;color: red;font-weight: bold;">0</td>
<!--											<td><a href="add_money.html?user_id=1'"
												th:href="@{'/users/detail.html?user_id=' + ${oneUser.id}}">Cộng
													tài khoản</a></td>-->
										</tr>
									</tbody>
								</table>
							</div>
							<!-- /.table-responsive -->
						</div>
						<!-- /.panel-body -->
					</div>
					<div hidden="true" id="type_data" th:text="${type}"></div>
				</div>
				<!-- /.panel -->
			</div>
			<!-- /.col-lg-12 -->
		</div>
		<!-- /.row -->
	</div>
	<!-- /#page-wrapper -->
	<!-- /#wrapper -->

	<!-- Core Scripts - Include with every page -->
	<script src="../js/jquery-1.10.2.js"
		th:src="@{/resources/sb-admin-v2/js/jquery-1.10.2.js}"></script>
	<script src="../js/bootstrap.min.js"
		th:src="@{/resources/sb-admin-v2/js/bootstrap.min.js}"></script>
	<script src="../js/plugins/metisMenu/jquery.metisMenu.js"
		th:src="@{/resources/sb-admin-v2/js/plugins/metisMenu/jquery.metisMenu.js}"></script>

	<!-- Page-Level Plugin Scripts - Tables -->
	<script src="../js/plugins/dataTables/jquery.dataTables.js"
		th:src="@{/resources/sb-admin-v2/js/plugins/dataTables/jquery.dataTables.js}"></script>
	<script src="../js/plugins/dataTables/dataTables.bootstrap.js"
		th:src="@{/resources/sb-admin-v2/js/plugins/dataTables/dataTables.bootstrap.js}"></script>


	<!-- SB Admin Scripts - Include with every page -->
	<script src="../js/sb-admin.js"
		th:src="@{/resources/sb-admin-v2/js/sb-admin.js}"></script>

	<!-- Page-Level Demo Scripts - Tables - Use for reference -->
	<script type="text/javascript"
		src="../bootstrap-daterangepicker/moment.js"
		th:src="@{/resources/bootstrap-daterangepicker/moment.js}"></script>
	<script type="text/javascript"
		src="../bootstrap-daterangepicker/daterangepicker.js"
		th:src="@{/resources/bootstrap-daterangepicker/daterangepicker.js}"></script>
	<script>
		$(document).ready(
				function() {
					/*$('#dataTables-user').dataTable();
					$('#dataTables-example').dataTable();
					// $('#dataTables-userTop').dataTable();
					$('#dataTables-userTop').dataTable({
						"order" : [ [ 5, "desc" ] ]
					});*/
					$('#reservationtime')
							.daterangepicker(
									{
										timePicker : false,
										format : 'YYYY/MM/DD'
									},
									function(start, end, label) {
										console.log('A date range was chosen: '
												+ start.format('YYYY-MM-DD')
												+ ' to '
												+ end.format('YYYY-MM-DD'));
										$('#from_date').val(
												start.format('YYYY-MM-DD'));
										$('#to_date').val(
												end.format('YYYY-MM-DD'));
									});
									if($('#sum_gold').text() != '0'){
											$('.total_user_gold').text(numberWithCommas($('#sum_gold').text()));
									} else {
										var total_gold = 0;
										$('td.user_gold_amount').each((i,o)=>{
	//                                            console.log("==========");
												var text = $(o).text()
	//                                            console.log("text1 :"+text);
												text = text.replaceAll(",", "")
	//                                            console.log("text2 :"+text);
												total_gold += parseInt(text);
	//                                            console.log("total_gold :"+total_gold);
										});
										$('.total_user_gold').text(numberWithCommas(total_gold));
									}
                                    console.log("total_gold after :"+total_gold);
				});
		function doSearchUser() {
			/* window.location.href = '@{/users/list.html?fullname=}' + $(".custom-search-form > input").val(); */
			window.location.href = $('#idSearchLink').val()
					+ $("#idSearchValue").val() + ';;;'
					+ $("#idSearchValueMobile").val();
			return false;

		};
                String.prototype.replaceAll = function(search, replacement) {
                                                    var target = this;
                                                    return target.replace(new RegExp(search, 'g'), replacement);
                                                };
                                                const numberWithCommas = (x) => {
                                                    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                                                }
	</script>
</body>

</html>
